"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.fixControlledValue=fixControlledValue,exports.resolveOnChange=resolveOnChange,exports.triggerFocus=triggerFocus,exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_createSuper2=_interopRequireDefault(require("@babel/runtime/helpers/createSuper")),React=_interopRequireWildcard(require("react")),_classnames=_interopRequireDefault(require("classnames")),_omit=_interopRequireDefault(require("rc-util/lib/omit")),_ClearableLabeledInput=_interopRequireDefault(require("./ClearableLabeledInput")),_configProvider=require("../config-provider"),_SizeContext=_interopRequireDefault(require("../config-provider/SizeContext")),_devWarning=_interopRequireDefault(require("../_util/devWarning")),_utils=require("./utils");function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function fixControlledValue(value){return null==value?"":value}function resolveOnChange(target,e,onChange,targetValue){if(onChange){var event=e,originalInputValue=target.value;return"click"===e.type?((event=Object.create(e)).target=target,event.currentTarget=target,target.value="",onChange(event),void(target.value=originalInputValue)):void 0!==targetValue?((event=Object.create(e)).target=target,event.currentTarget=target,target.value=targetValue,void onChange(event)):void onChange(event)}}function triggerFocus(element,option){if(element){element.focus(option);var cursor=(option||{}).cursor;if(cursor){var len=element.value.length;switch(cursor){case"start":element.setSelectionRange(0,0);break;case"end":element.setSelectionRange(len,len);break;default:element.setSelectionRange(0,len)}}}}var Input=function(_React$Component){(0,_inherits2.default)(Input,_React$Component);var _super=(0,_createSuper2.default)(Input);function Input(props){var _this;(0,_classCallCheck2.default)(this,Input),(_this=_super.call(this,props)).direction="ltr",_this.focus=function(option){triggerFocus(_this.input,option)},_this.saveClearableInput=function(input){_this.clearableInput=input},_this.saveInput=function(input){_this.input=input},_this.onFocus=function(e){var onFocus=_this.props.onFocus;_this.setState({focused:!0},_this.clearPasswordValueAttribute),null==onFocus||onFocus(e)},_this.onBlur=function(e){var onBlur=_this.props.onBlur;_this.setState({focused:!1},_this.clearPasswordValueAttribute),null==onBlur||onBlur(e)},_this.handleReset=function(e){_this.setValue("",(function(){_this.focus()})),resolveOnChange(_this.input,e,_this.props.onChange)},_this.renderInput=function(prefixCls,size,bordered){var input=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},_this$props=_this.props,className=_this$props.className,addonBefore=_this$props.addonBefore,addonAfter=_this$props.addonAfter,customizeSize=_this$props.size,disabled=_this$props.disabled,otherProps=(0,_omit.default)(_this.props,["prefixCls","onPressEnter","addonBefore","addonAfter","prefix","suffix","allowClear","defaultValue","size","inputType","bordered"]);return React.createElement("input",(0,_extends2.default)({autoComplete:input.autoComplete},otherProps,{onChange:_this.handleChange,onFocus:_this.onFocus,onBlur:_this.onBlur,onKeyDown:_this.handleKeyDown,className:(0,_classnames.default)((0,_utils.getInputClassName)(prefixCls,bordered,customizeSize||size,disabled,_this.direction),(0,_defineProperty2.default)({},className,className&&!addonBefore&&!addonAfter)),ref:_this.saveInput}))},_this.clearPasswordValueAttribute=function(){_this.removePasswordTimeout=setTimeout((function(){_this.input&&"password"===_this.input.getAttribute("type")&&_this.input.hasAttribute("value")&&_this.input.removeAttribute("value")}))},_this.handleChange=function(e){_this.setValue(e.target.value,_this.clearPasswordValueAttribute),resolveOnChange(_this.input,e,_this.props.onChange)},_this.handleKeyDown=function(e){var _this$props2=_this.props,onPressEnter=_this$props2.onPressEnter,onKeyDown=_this$props2.onKeyDown;onPressEnter&&13===e.keyCode&&onPressEnter(e),null==onKeyDown||onKeyDown(e)},_this.renderComponent=function(_ref2){var getPrefixCls=_ref2.getPrefixCls,direction=_ref2.direction,input=_ref2.input,_this$state=_this.state,value=_this$state.value,focused=_this$state.focused,_this$props3=_this.props,customizePrefixCls=_this$props3.prefixCls,_this$props3$bordered=_this$props3.bordered,bordered=void 0===_this$props3$bordered||_this$props3$bordered,prefixCls=getPrefixCls("input",customizePrefixCls);return _this.direction=direction,React.createElement(_SizeContext.default.Consumer,null,(function(size){return React.createElement(_ClearableLabeledInput.default,(0,_extends2.default)({size:size},_this.props,{prefixCls:prefixCls,inputType:"input",value:fixControlledValue(value),element:_this.renderInput(prefixCls,size,bordered,input),handleReset:_this.handleReset,ref:_this.saveClearableInput,direction:direction,focused:focused,triggerFocus:_this.focus,bordered:bordered}))}))};var value=void 0===props.value?props.defaultValue:props.value;return _this.state={value:value,focused:!1,prevValue:props.value},_this}return(0,_createClass2.default)(Input,[{key:"componentDidMount",value:function componentDidMount(){this.clearPasswordValueAttribute()}},{key:"componentDidUpdate",value:function componentDidUpdate(){}},{key:"getSnapshotBeforeUpdate",value:function getSnapshotBeforeUpdate(prevProps){return(0,_utils.hasPrefixSuffix)(prevProps)!==(0,_utils.hasPrefixSuffix)(this.props)&&(0,_devWarning.default)(this.input!==document.activeElement,"Input","When Input is focused, dynamic add or remove prefix / suffix will make it lose focus caused by dom structure change. Read more: https://ant.design/components/input/#FAQ"),null}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.removePasswordTimeout&&clearTimeout(this.removePasswordTimeout)}},{key:"blur",value:function blur(){this.input.blur()}},{key:"setSelectionRange",value:function setSelectionRange(start,end,direction){this.input.setSelectionRange(start,end,direction)}},{key:"select",value:function select(){this.input.select()}},{key:"setValue",value:function setValue(value,callback){void 0===this.props.value?this.setState({value:value},callback):null==callback||callback()}},{key:"render",value:function render(){return React.createElement(_configProvider.ConfigConsumer,null,this.renderComponent)}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(nextProps,_ref3){var prevValue=_ref3.prevValue,newState={prevValue:nextProps.value};return void 0===nextProps.value&&prevValue===nextProps.value||(newState.value=nextProps.value),newState}}]),Input}(React.Component);Input.defaultProps={type:"text"};var _default=Input;exports.default=_default;