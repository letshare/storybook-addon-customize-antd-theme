"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof3=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),React=_interopRequireWildcard(require("react")),_rcTextarea=_interopRequireDefault(require("rc-textarea")),_omit=_interopRequireDefault(require("rc-util/lib/omit")),_classnames=_interopRequireDefault(require("classnames")),_useMergedState3=_interopRequireDefault(require("rc-util/lib/hooks/useMergedState")),_ClearableLabeledInput=_interopRequireDefault(require("./ClearableLabeledInput")),_configProvider=require("../config-provider"),_Input=require("./Input"),_SizeContext=_interopRequireDefault(require("../config-provider/SizeContext"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof3(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var __rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};function fixEmojiLength(value,maxLength){return(0,_toConsumableArray2.default)(value||"").slice(0,maxLength).join("")}var TextArea=React.forwardRef((function(_a,ref){var _classNames,customizePrefixCls=_a.prefixCls,_a$bordered=_a.bordered,bordered=void 0===_a$bordered||_a$bordered,_a$showCount=_a.showCount,showCount=void 0!==_a$showCount&&_a$showCount,maxLength=_a.maxLength,className=_a.className,style=_a.style,customizeSize=_a.size,onCompositionStart=_a.onCompositionStart,onCompositionEnd=_a.onCompositionEnd,onChange=_a.onChange,props=__rest(_a,["prefixCls","bordered","showCount","maxLength","className","style","size","onCompositionStart","onCompositionEnd","onChange"]),_React$useContext=React.useContext(_configProvider.ConfigContext),getPrefixCls=_React$useContext.getPrefixCls,direction=_React$useContext.direction,size=React.useContext(_SizeContext.default),innerRef=React.useRef(null),clearableInputRef=React.useRef(null),_React$useState=React.useState(!1),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),compositing=_React$useState2[0],setCompositing=_React$useState2[1],_useMergedState=(0,_useMergedState3.default)(props.defaultValue,{value:props.value}),_useMergedState2=(0,_slicedToArray2.default)(_useMergedState,2),value=_useMergedState2[0],setValue=_useMergedState2[1],handleSetValue=function handleSetValue(val,callback){void 0===props.value&&(setValue(val),null==callback||callback())},hasMaxLength=Number(maxLength)>0,prefixCls=getPrefixCls("input",customizePrefixCls);React.useImperativeHandle(ref,(function(){var _a;return{resizableTextArea:null===(_a=innerRef.current)||void 0===_a?void 0:_a.resizableTextArea,focus:function focus(option){var _a,_b;(0,_Input.triggerFocus)(null===(_b=null===(_a=innerRef.current)||void 0===_a?void 0:_a.resizableTextArea)||void 0===_b?void 0:_b.textArea,option)},blur:function blur(){var _a;return null===(_a=innerRef.current)||void 0===_a?void 0:_a.blur()}}}));var textArea=React.createElement(_rcTextarea.default,(0,_extends2.default)({},(0,_omit.default)(props,["allowClear"]),{className:(0,_classnames.default)((_classNames={},(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-borderless"),!bordered),(0,_defineProperty2.default)(_classNames,className,className&&!showCount),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-sm"),"small"===size||"small"===customizeSize),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-lg"),"large"===size||"large"===customizeSize),_classNames)),style:showCount?void 0:style,prefixCls:prefixCls,onCompositionStart:function onInternalCompositionStart(e){setCompositing(!0),null==onCompositionStart||onCompositionStart(e)},onChange:function handleChange(e){var triggerValue=e.target.value;!compositing&&hasMaxLength&&(triggerValue=fixEmojiLength(triggerValue,maxLength)),handleSetValue(triggerValue),(0,_Input.resolveOnChange)(e.currentTarget,e,onChange,triggerValue)},onCompositionEnd:function onInternalCompositionEnd(e){setCompositing(!1);var triggerValue=e.currentTarget.value;hasMaxLength&&(triggerValue=fixEmojiLength(triggerValue,maxLength)),triggerValue!==value&&(handleSetValue(triggerValue),(0,_Input.resolveOnChange)(e.currentTarget,e,onChange,triggerValue)),null==onCompositionEnd||onCompositionEnd(e)},ref:innerRef})),val=(0,_Input.fixControlledValue)(value);compositing||!hasMaxLength||null!==props.value&&void 0!==props.value||(val=fixEmojiLength(val,maxLength));var textareaNode=React.createElement(_ClearableLabeledInput.default,(0,_extends2.default)({},props,{prefixCls:prefixCls,direction:direction,inputType:"text",value:val,element:textArea,handleReset:function handleReset(e){var _a,_b;handleSetValue("",(function(){var _a;null===(_a=innerRef.current)||void 0===_a||_a.focus()})),(0,_Input.resolveOnChange)(null===(_b=null===(_a=innerRef.current)||void 0===_a?void 0:_a.resizableTextArea)||void 0===_b?void 0:_b.textArea,e,onChange)},ref:clearableInputRef,bordered:bordered,style:showCount?void 0:style}));if(showCount){var valueLength=(0,_toConsumableArray2.default)(val).length,dataCount="";return dataCount="object"===(0,_typeof2.default)(showCount)?showCount.formatter({count:valueLength,maxLength:maxLength}):"".concat(valueLength).concat(hasMaxLength?" / ".concat(maxLength):""),React.createElement("div",{className:(0,_classnames.default)("".concat(prefixCls,"-textarea"),(0,_defineProperty2.default)({},"".concat(prefixCls,"-textarea-rtl"),"rtl"===direction),"".concat(prefixCls,"-textarea-show-count"),className),style:style,"data-count":dataCount},textareaNode)}return textareaNode})),_default=TextArea;exports.default=_default;