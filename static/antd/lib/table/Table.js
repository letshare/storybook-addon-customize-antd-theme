"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof3=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),React=_interopRequireWildcard(require("react")),_classnames=_interopRequireDefault(require("classnames")),_omit=_interopRequireDefault(require("rc-util/lib/omit")),_rcTable=_interopRequireWildcard(require("rc-table")),_Table=require("rc-table/lib/Table"),_useColumns=require("rc-table/lib/hooks/useColumns"),_spin=_interopRequireDefault(require("../spin")),_pagination=_interopRequireDefault(require("../pagination")),_context=require("../config-provider/context"),_usePagination3=_interopRequireWildcard(require("./hooks/usePagination")),_useLazyKVMap3=_interopRequireDefault(require("./hooks/useLazyKVMap")),_useSelection3=_interopRequireWildcard(require("./hooks/useSelection")),_useSorter3=_interopRequireWildcard(require("./hooks/useSorter")),_useFilter3=_interopRequireWildcard(require("./hooks/useFilter")),_useTitleColumns3=_interopRequireDefault(require("./hooks/useTitleColumns")),_ExpandIcon=_interopRequireDefault(require("./ExpandIcon")),_scrollTo=_interopRequireDefault(require("../_util/scrollTo")),_en_US=_interopRequireDefault(require("../locale/en_US")),_SizeContext=_interopRequireDefault(require("../config-provider/SizeContext")),_Column=_interopRequireDefault(require("./Column")),_ColumnGroup=_interopRequireDefault(require("./ColumnGroup")),_devWarning=_interopRequireDefault(require("../_util/devWarning")),_useBreakpoint=_interopRequireDefault(require("../grid/hooks/useBreakpoint"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof3(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var EMPTY_LIST=[];function Table(props){var _classNames3,customizePrefixCls=props.prefixCls,className=props.className,style=props.style,customizeSize=props.size,bordered=props.bordered,customizeDropdownPrefixCls=props.dropdownPrefixCls,dataSource=props.dataSource,pagination=props.pagination,rowSelection=props.rowSelection,rowKey=props.rowKey,rowClassName=props.rowClassName,columns=props.columns,children=props.children,legacyChildrenColumnName=props.childrenColumnName,onChange=props.onChange,getPopupContainer=props.getPopupContainer,loading=props.loading,expandIcon=props.expandIcon,expandable=props.expandable,expandedRowRender=props.expandedRowRender,expandIconColumnIndex=props.expandIconColumnIndex,indentSize=props.indentSize,scroll=props.scroll,sortDirections=props.sortDirections,locale=props.locale,_props$showSorterTool=props.showSorterTooltip,showSorterTooltip=void 0===_props$showSorterTool||_props$showSorterTool;(0,_devWarning.default)(!("function"==typeof rowKey&&rowKey.length>1),"Table","`index` parameter of `rowKey` function is deprecated. There is no guarantee that it will work as expected.");var screens=(0,_useBreakpoint.default)(),mergedColumns=React.useMemo((function(){var matched=new Set(Object.keys(screens).filter((function(m){return screens[m]})));return(columns||(0,_useColumns.convertChildrenToColumns)(children)).filter((function(c){return!c.responsive||c.responsive.some((function(r){return matched.has(r)}))}))}),[children,columns,screens]),tableProps=(0,_omit.default)(props,["className","style","columns"]),size=React.useContext(_SizeContext.default),_React$useContext=React.useContext(_context.ConfigContext),_React$useContext$loc=_React$useContext.locale,contextLocale=void 0===_React$useContext$loc?_en_US.default:_React$useContext$loc,renderEmpty=_React$useContext.renderEmpty,direction=_React$useContext.direction,mergedSize=customizeSize||size,tableLocale=(0,_extends2.default)((0,_extends2.default)({},contextLocale.Table),locale),rawData=dataSource||EMPTY_LIST,getPrefixCls=React.useContext(_context.ConfigContext).getPrefixCls,prefixCls=getPrefixCls("table",customizePrefixCls),dropdownPrefixCls=getPrefixCls("dropdown",customizeDropdownPrefixCls),mergedExpandable=(0,_extends2.default)({childrenColumnName:legacyChildrenColumnName,expandIconColumnIndex:expandIconColumnIndex},expandable),_mergedExpandable$chi=mergedExpandable.childrenColumnName,childrenColumnName=void 0===_mergedExpandable$chi?"children":_mergedExpandable$chi,expandType=React.useMemo((function(){return rawData.some((function(item){var _a;return null===(_a=item)||void 0===_a?void 0:_a[childrenColumnName]}))?"nest":expandedRowRender||expandable&&expandable.expandedRowRender?"row":null}),[rawData]),internalRefs={body:React.useRef()},getRowKey=React.useMemo((function(){return"function"==typeof rowKey?rowKey:function(record){var _a;return null===(_a=record)||void 0===_a?void 0:_a[rowKey]}}),[rowKey]),_useLazyKVMap=(0,_useLazyKVMap3.default)(rawData,childrenColumnName,getRowKey),getRecordByKey=(0,_slicedToArray2.default)(_useLazyKVMap,1)[0],changeEventInfo={},triggerOnChange=function triggerOnChange(info,action){var reset=arguments.length>2&&void 0!==arguments[2]&&arguments[2],changeInfo=(0,_extends2.default)((0,_extends2.default)({},changeEventInfo),info);reset&&(changeEventInfo.resetPagination(),changeInfo.pagination.current&&(changeInfo.pagination.current=1),pagination&&pagination.onChange&&pagination.onChange(1,changeInfo.pagination.pageSize)),scroll&&!1!==scroll.scrollToFirstRowOnChange&&internalRefs.body.current&&(0,_scrollTo.default)(0,{getContainer:function getContainer(){return internalRefs.body.current}}),null==onChange||onChange(changeInfo.pagination,changeInfo.filters,changeInfo.sorter,{currentDataSource:(0,_useFilter3.getFilterData)((0,_useSorter3.getSortData)(rawData,changeInfo.sorterStates,childrenColumnName),changeInfo.filterStates),action:action})},_useSorter=(0,_useSorter3.default)({prefixCls:prefixCls,mergedColumns:mergedColumns,onSorterChange:function onSorterChange(sorter,sorterStates){triggerOnChange({sorter:sorter,sorterStates:sorterStates},"sort",!1)},sortDirections:sortDirections||["ascend","descend"],tableLocale:tableLocale,showSorterTooltip:showSorterTooltip}),_useSorter2=(0,_slicedToArray2.default)(_useSorter,4),transformSorterColumns=_useSorter2[0],sortStates=_useSorter2[1],sorterTitleProps=_useSorter2[2],getSorters=_useSorter2[3],sortedData=React.useMemo((function(){return(0,_useSorter3.getSortData)(rawData,sortStates,childrenColumnName)}),[rawData,sortStates]);changeEventInfo.sorter=getSorters(),changeEventInfo.sorterStates=sortStates;var _useFilter=(0,_useFilter3.default)({prefixCls:prefixCls,locale:tableLocale,dropdownPrefixCls:dropdownPrefixCls,mergedColumns:mergedColumns,onFilterChange:function onFilterChange(filters,filterStates){triggerOnChange({filters:filters,filterStates:filterStates},"filter",!0)},getPopupContainer:getPopupContainer}),_useFilter2=(0,_slicedToArray2.default)(_useFilter,3),transformFilterColumns=_useFilter2[0],filterStates=_useFilter2[1],getFilters=_useFilter2[2],mergedData=(0,_useFilter3.getFilterData)(sortedData,filterStates);changeEventInfo.filters=getFilters(),changeEventInfo.filterStates=filterStates;var columnTitleProps=React.useMemo((function(){return(0,_extends2.default)({},sorterTitleProps)}),[sorterTitleProps]),_useTitleColumns=(0,_useTitleColumns3.default)(columnTitleProps),transformTitleColumns=(0,_slicedToArray2.default)(_useTitleColumns,1)[0],_usePagination=(0,_usePagination3.default)(mergedData.length,pagination,(function onPaginationChange(current,pageSize){triggerOnChange({pagination:(0,_extends2.default)((0,_extends2.default)({},changeEventInfo.pagination),{current:current,pageSize:pageSize})},"paginate")})),_usePagination2=(0,_slicedToArray2.default)(_usePagination,2),mergedPagination=_usePagination2[0],resetPagination=_usePagination2[1];changeEventInfo.pagination=!1===pagination?{}:(0,_usePagination3.getPaginationParam)(pagination,mergedPagination),changeEventInfo.resetPagination=resetPagination;var pageData=React.useMemo((function(){if(!1===pagination||!mergedPagination.pageSize)return mergedData;var _mergedPagination$cur=mergedPagination.current,current=void 0===_mergedPagination$cur?1:_mergedPagination$cur,total=mergedPagination.total,_mergedPagination$pag=mergedPagination.pageSize,pageSize=void 0===_mergedPagination$pag?_usePagination3.DEFAULT_PAGE_SIZE:_mergedPagination$pag;return(0,_devWarning.default)(current>0,"Table","`current` should be positive number."),mergedData.length<total?mergedData.length>pageSize?((0,_devWarning.default)(!1,"Table","`dataSource` length is less than `pagination.total` but large than `pagination.pageSize`. Please make sure your config correct data with async mode."),mergedData.slice((current-1)*pageSize,current*pageSize)):mergedData:mergedData.slice((current-1)*pageSize,current*pageSize)}),[!!pagination,mergedData,mergedPagination&&mergedPagination.current,mergedPagination&&mergedPagination.pageSize,mergedPagination&&mergedPagination.total]),_useSelection=(0,_useSelection3.default)(rowSelection,{prefixCls:prefixCls,data:mergedData,pageData:pageData,getRowKey:getRowKey,getRecordByKey:getRecordByKey,expandType:expandType,childrenColumnName:childrenColumnName,locale:tableLocale,expandIconColumnIndex:mergedExpandable.expandIconColumnIndex,getPopupContainer:getPopupContainer}),_useSelection2=(0,_slicedToArray2.default)(_useSelection,2),transformSelectionColumns=_useSelection2[0],selectedKeySet=_useSelection2[1];mergedExpandable.__PARENT_RENDER_ICON__=mergedExpandable.expandIcon,mergedExpandable.expandIcon=mergedExpandable.expandIcon||expandIcon||(0,_ExpandIcon.default)(tableLocale),"nest"===expandType&&void 0===mergedExpandable.expandIconColumnIndex?mergedExpandable.expandIconColumnIndex=rowSelection?1:0:mergedExpandable.expandIconColumnIndex>0&&rowSelection&&(mergedExpandable.expandIconColumnIndex-=1),"number"!=typeof mergedExpandable.indentSize&&(mergedExpandable.indentSize="number"==typeof indentSize?indentSize:15);var topPaginationNode,bottomPaginationNode,spinProps,transformColumns=React.useCallback((function(innerColumns){return transformTitleColumns(transformSelectionColumns(transformFilterColumns(transformSorterColumns(innerColumns))))}),[transformSorterColumns,transformFilterColumns,transformSelectionColumns]);if(!1!==pagination&&(null==mergedPagination?void 0:mergedPagination.total)){var paginationSize;paginationSize=mergedPagination.size?mergedPagination.size:"small"===mergedSize||"middle"===mergedSize?"small":void 0;var renderPagination=function renderPagination(position){return React.createElement(_pagination.default,(0,_extends2.default)({className:"".concat(prefixCls,"-pagination ").concat(prefixCls,"-pagination-").concat(position)},mergedPagination,{size:paginationSize}))},defaultPosition="rtl"===direction?"left":"right",position=mergedPagination.position;if(null!==position&&Array.isArray(position)){var topPos=position.find((function(p){return-1!==p.indexOf("top")})),bottomPos=position.find((function(p){return-1!==p.indexOf("bottom")})),isDisable=position.every((function(p){return"none"==="".concat(p)}));topPos||bottomPos||isDisable||(bottomPaginationNode=renderPagination(defaultPosition)),topPos&&(topPaginationNode=renderPagination(topPos.toLowerCase().replace("top",""))),bottomPos&&(bottomPaginationNode=renderPagination(bottomPos.toLowerCase().replace("bottom","")))}else bottomPaginationNode=renderPagination(defaultPosition)}"boolean"==typeof loading?spinProps={spinning:loading}:"object"===(0,_typeof2.default)(loading)&&(spinProps=(0,_extends2.default)({spinning:!0},loading));var wrapperClassNames=(0,_classnames.default)("".concat(prefixCls,"-wrapper"),(0,_defineProperty2.default)({},"".concat(prefixCls,"-wrapper-rtl"),"rtl"===direction),className);return React.createElement("div",{className:wrapperClassNames,style:style},React.createElement(_spin.default,(0,_extends2.default)({spinning:!1},spinProps),topPaginationNode,React.createElement(_rcTable.default,(0,_extends2.default)({},tableProps,{columns:mergedColumns,direction:direction,expandable:mergedExpandable,prefixCls:prefixCls,className:(0,_classnames.default)((_classNames3={},(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-middle"),"middle"===mergedSize),(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-small"),"small"===mergedSize),(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-bordered"),bordered),(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-empty"),0===rawData.length),_classNames3)),data:pageData,rowKey:getRowKey,rowClassName:function internalRowClassName(record,index,indent){var mergedRowClassName;return mergedRowClassName="function"==typeof rowClassName?(0,_classnames.default)(rowClassName(record,index,indent)):(0,_classnames.default)(rowClassName),(0,_classnames.default)((0,_defineProperty2.default)({},"".concat(prefixCls,"-row-selected"),selectedKeySet.has(getRowKey(record,index))),mergedRowClassName)},emptyText:locale&&locale.emptyText||renderEmpty("Table"),internalHooks:_Table.INTERNAL_HOOKS,internalRefs:internalRefs,transformColumns:transformColumns})),bottomPaginationNode))}Table.defaultProps={rowKey:"key"},Table.SELECTION_ALL=_useSelection3.SELECTION_ALL,Table.SELECTION_INVERT=_useSelection3.SELECTION_INVERT,Table.SELECTION_NONE=_useSelection3.SELECTION_NONE,Table.Column=_Column.default,Table.ColumnGroup=_ColumnGroup.default,Table.Summary=_rcTable.Summary;var _default=Table;exports.default=_default;