"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),React=_interopRequireWildcard(require("react")),_classnames=_interopRequireDefault(require("classnames")),_isEqual=_interopRequireDefault(require("lodash/isEqual")),_FilterFilled=_interopRequireDefault(require("@ant-design/icons/FilterFilled")),_button=_interopRequireDefault(require("../../../button")),_menu=_interopRequireDefault(require("../../../menu")),_checkbox=_interopRequireDefault(require("../../../checkbox")),_radio=_interopRequireDefault(require("../../../radio")),_dropdown=_interopRequireDefault(require("../../../dropdown")),_empty=_interopRequireDefault(require("../../../empty")),_FilterWrapper=_interopRequireDefault(require("./FilterWrapper")),_useSyncState3=_interopRequireDefault(require("../../../_util/hooks/useSyncState")),_context=require("../../../config-provider/context");function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var SubMenu=_menu.default.SubMenu,MenuItem=_menu.default.Item;function hasSubMenu(filters){return filters.some((function(_ref){return _ref.children}))}function renderFilterItems(_ref2){var filters=_ref2.filters,prefixCls=_ref2.prefixCls,filteredKeys=_ref2.filteredKeys,filterMultiple=_ref2.filterMultiple,locale=_ref2.locale;return 0===filters.length?React.createElement(MenuItem,{key:"empty"},React.createElement("div",{style:{margin:"16px 0"}},React.createElement(_empty.default,{image:_empty.default.PRESENTED_IMAGE_SIMPLE,description:locale.filterEmptyText,imageStyle:{height:24}}))):filters.map((function(filter,index){var key=String(filter.value);if(filter.children)return React.createElement(SubMenu,{key:key||index,title:filter.text,popupClassName:"".concat(prefixCls,"-dropdown-submenu")},renderFilterItems({filters:filter.children,prefixCls:prefixCls,filteredKeys:filteredKeys,filterMultiple:filterMultiple,locale:locale}));var Component=filterMultiple?_checkbox.default:_radio.default;return React.createElement(MenuItem,{key:void 0!==filter.value?key:index},React.createElement(Component,{checked:filteredKeys.includes(key)}),React.createElement("span",null,filter.text))}))}function FilterDropdown(props){var _a,tablePrefixCls=props.tablePrefixCls,prefixCls=props.prefixCls,column=props.column,dropdownPrefixCls=props.dropdownPrefixCls,columnKey=props.columnKey,filterMultiple=props.filterMultiple,filterState=props.filterState,triggerFilter=props.triggerFilter,locale=props.locale,children=props.children,getPopupContainer=props.getPopupContainer,filterDropdownVisible=column.filterDropdownVisible,onFilterDropdownVisibleChange=column.onFilterDropdownVisibleChange,_React$useState=React.useState(!1),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),visible=_React$useState2[0],setVisible=_React$useState2[1],filtered=!(!filterState||!(null===(_a=filterState.filteredKeys)||void 0===_a?void 0:_a.length)&&!filterState.forceFiltered),triggerVisible=function triggerVisible(newVisible){setVisible(newVisible),null==onFilterDropdownVisibleChange||onFilterDropdownVisibleChange(newVisible)},mergedVisible="boolean"==typeof filterDropdownVisible?filterDropdownVisible:visible,propFilteredKeys=null==filterState?void 0:filterState.filteredKeys,_useSyncState=(0,_useSyncState3.default)(propFilteredKeys||[]),_useSyncState2=(0,_slicedToArray2.default)(_useSyncState,2),getFilteredKeysSync=_useSyncState2[0],setFilteredKeysSync=_useSyncState2[1],onSelectKeys=function onSelectKeys(_ref3){var selectedKeys=_ref3.selectedKeys;setFilteredKeysSync(selectedKeys)};React.useEffect((function(){onSelectKeys({selectedKeys:propFilteredKeys||[]})}),[propFilteredKeys]);var _React$useState3=React.useState([]),_React$useState4=(0,_slicedToArray2.default)(_React$useState3,2),openKeys=_React$useState4[0],setOpenKeys=_React$useState4[1],openRef=React.useRef();React.useEffect((function(){return function(){window.clearTimeout(openRef.current)}}),[]);var dropdownContent,internalTriggerFilter=function internalTriggerFilter(keys){var mergedKeys=keys&&keys.length?keys:null;return null!==mergedKeys||filterState&&filterState.filteredKeys?(0,_isEqual.default)(mergedKeys,null==filterState?void 0:filterState.filteredKeys)?null:void triggerFilter({column:column,key:columnKey,filteredKeys:mergedKeys}):null},onConfirm=function onConfirm(){triggerVisible(!1),internalTriggerFilter(getFilteredKeysSync())},onReset=function onReset(){setFilteredKeysSync([]),triggerVisible(!1),internalTriggerFilter([])},dropdownMenuClass=(0,_classnames.default)((0,_defineProperty2.default)({},"".concat(dropdownPrefixCls,"-menu-without-submenu"),!hasSubMenu(column.filters||[])));if("function"==typeof column.filterDropdown)dropdownContent=column.filterDropdown({prefixCls:"".concat(dropdownPrefixCls,"-custom"),setSelectedKeys:function setSelectedKeys(selectedKeys){return onSelectKeys({selectedKeys:selectedKeys})},selectedKeys:getFilteredKeysSync(),confirm:function doFilter(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{closeDropdown:!0}).closeDropdown&&triggerVisible(!1),internalTriggerFilter(getFilteredKeysSync())},clearFilters:onReset,filters:column.filters,visible:mergedVisible});else if(column.filterDropdown)dropdownContent=column.filterDropdown;else{var selectedKeys=getFilteredKeysSync()||[];dropdownContent=React.createElement(React.Fragment,null,React.createElement(_menu.default,{multiple:filterMultiple,prefixCls:"".concat(dropdownPrefixCls,"-menu"),className:dropdownMenuClass,onClick:function onMenuClick(){window.clearTimeout(openRef.current)},onSelect:onSelectKeys,onDeselect:onSelectKeys,selectedKeys:selectedKeys,getPopupContainer:getPopupContainer,openKeys:openKeys,onOpenChange:function onOpenChange(keys){openRef.current=window.setTimeout((function(){setOpenKeys(keys)}))}},renderFilterItems({filters:column.filters||[],prefixCls:prefixCls,filteredKeys:getFilteredKeysSync(),filterMultiple:filterMultiple,locale:locale})),React.createElement("div",{className:"".concat(prefixCls,"-dropdown-btns")},React.createElement(_button.default,{type:"link",size:"small",disabled:0===selectedKeys.length,onClick:onReset},locale.filterReset),React.createElement(_button.default,{type:"primary",size:"small",onClick:onConfirm},locale.filterConfirm)))}var filterIcon,menu=React.createElement(_FilterWrapper.default,{className:"".concat(prefixCls,"-dropdown")},dropdownContent);filterIcon="function"==typeof column.filterIcon?column.filterIcon(filtered):column.filterIcon?column.filterIcon:React.createElement(_FilterFilled.default,null);var direction=React.useContext(_context.ConfigContext).direction;return React.createElement("div",{className:"".concat(prefixCls,"-column")},React.createElement("span",{className:"".concat(tablePrefixCls,"-column-title")},children),React.createElement(_dropdown.default,{overlay:menu,trigger:["click"],visible:mergedVisible,onVisibleChange:function onVisibleChange(newVisible){newVisible&&void 0!==propFilteredKeys&&setFilteredKeysSync(propFilteredKeys||[]),triggerVisible(newVisible),newVisible||column.filterDropdown||onConfirm()},getPopupContainer:getPopupContainer,placement:"rtl"===direction?"bottomLeft":"bottomRight"},React.createElement("span",{role:"button",tabIndex:-1,className:(0,_classnames.default)("".concat(prefixCls,"-trigger"),{active:filtered}),onClick:function onClick(e){e.stopPropagation()}},filterIcon)))}var _default=FilterDropdown;exports.default=_default;