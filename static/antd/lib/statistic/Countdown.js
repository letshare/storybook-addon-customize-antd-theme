"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_createSuper2=_interopRequireDefault(require("@babel/runtime/helpers/createSuper")),React=_interopRequireWildcard(require("react")),_Statistic=_interopRequireDefault(require("./Statistic")),_utils=require("./utils"),_reactNode=require("../_util/reactNode");function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var REFRESH_INTERVAL=1e3/30;function getTime(value){return new Date(value).getTime()}var Countdown=function(_React$Component){(0,_inherits2.default)(Countdown,_React$Component);var _super=(0,_createSuper2.default)(Countdown);function Countdown(){var _this;return(0,_classCallCheck2.default)(this,Countdown),(_this=_super.apply(this,arguments)).syncTimer=function(){getTime(_this.props.value)>=Date.now()?_this.startTimer():_this.stopTimer()},_this.startTimer=function(){if(!_this.countdownId){var _this$props=_this.props,onChange=_this$props.onChange,timestamp=getTime(_this$props.value);_this.countdownId=window.setInterval((function(){_this.forceUpdate(),onChange&&timestamp>Date.now()&&onChange(timestamp-Date.now())}),REFRESH_INTERVAL)}},_this.stopTimer=function(){var _this$props2=_this.props,onFinish=_this$props2.onFinish,value=_this$props2.value;if(_this.countdownId){clearInterval(_this.countdownId),_this.countdownId=void 0;var timestamp=getTime(value);onFinish&&timestamp<Date.now()&&onFinish()}},_this.formatCountdown=function(value,config){var format=_this.props.format;return(0,_utils.formatCountdown)(value,(0,_extends2.default)((0,_extends2.default)({},config),{format:format}))},_this.valueRender=function(node){return(0,_reactNode.cloneElement)(node,{title:void 0})},_this}return(0,_createClass2.default)(Countdown,[{key:"componentDidMount",value:function componentDidMount(){this.syncTimer()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.syncTimer()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.stopTimer()}},{key:"render",value:function render(){return React.createElement(_Statistic.default,(0,_extends2.default)({valueRender:this.valueRender},this.props,{formatter:this.formatCountdown}))}}]),Countdown}(React.Component);Countdown.defaultProps={format:"HH:mm:ss"};var _default=Countdown;exports.default=_default;