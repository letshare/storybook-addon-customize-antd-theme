"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),React=_interopRequireWildcard(require("react")),_useMergedState5=_interopRequireDefault(require("rc-util/lib/hooks/useMergedState")),_classnames=_interopRequireDefault(require("classnames")),_padStart=_interopRequireDefault(require("lodash/padStart")),_rcPicker=require("rc-picker"),_LocaleReceiver=_interopRequireDefault(require("../locale-provider/LocaleReceiver")),_en_US=_interopRequireDefault(require("./locale/en_US")),_configProvider=require("../config-provider"),_Header=_interopRequireDefault(require("./Header"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function generateCalendar(generateConfig){function isSameYear(date1,date2){return date1&&date2&&generateConfig.getYear(date1)===generateConfig.getYear(date2)}function isSameMonth(date1,date2){return isSameYear(date1,date2)&&generateConfig.getMonth(date1)===generateConfig.getMonth(date2)}function isSameDate(date1,date2){return isSameMonth(date1,date2)&&generateConfig.getDate(date1)===generateConfig.getDate(date2)}return function Calendar(props){var customizePrefixCls=props.prefixCls,className=props.className,style=props.style,dateFullCellRender=props.dateFullCellRender,dateCellRender=props.dateCellRender,monthFullCellRender=props.monthFullCellRender,monthCellRender=props.monthCellRender,headerRender=props.headerRender,value=props.value,defaultValue=props.defaultValue,disabledDate=props.disabledDate,mode=props.mode,validRange=props.validRange,_props$fullscreen=props.fullscreen,fullscreen=void 0===_props$fullscreen||_props$fullscreen,onChange=props.onChange,onPanelChange=props.onPanelChange,onSelect=props.onSelect,_React$useContext=React.useContext(_configProvider.ConfigContext),getPrefixCls=_React$useContext.getPrefixCls,direction=_React$useContext.direction,prefixCls=getPrefixCls("picker",customizePrefixCls),calendarPrefixCls="".concat(prefixCls,"-calendar"),today=generateConfig.getNow(),_useMergedState=(0,_useMergedState5.default)((function(){return value||generateConfig.getNow()}),{defaultValue:defaultValue,value:value}),_useMergedState2=(0,_slicedToArray2.default)(_useMergedState,2),mergedValue=_useMergedState2[0],setMergedValue=_useMergedState2[1],_useMergedState3=(0,_useMergedState5.default)("month",{value:mode}),_useMergedState4=(0,_slicedToArray2.default)(_useMergedState3,2),mergedMode=_useMergedState4[0],setMergedMode=_useMergedState4[1],panelMode=React.useMemo((function(){return"year"===mergedMode?"month":"date"}),[mergedMode]),mergedDisabledDate=React.useCallback((function(date){return!!validRange&&(generateConfig.isAfter(validRange[0],date)||generateConfig.isAfter(date,validRange[1]))||!!(null==disabledDate?void 0:disabledDate(date))}),[disabledDate,validRange]),triggerPanelChange=function triggerPanelChange(date,newMode){null==onPanelChange||onPanelChange(date,newMode)},triggerModeChange=function triggerModeChange(newMode){setMergedMode(newMode),triggerPanelChange(mergedValue,newMode)},onInternalSelect=function onInternalSelect(date){!function triggerChange(date){setMergedValue(date),isSameDate(date,mergedValue)||(("date"===panelMode&&!isSameMonth(date,mergedValue)||"month"===panelMode&&!isSameYear(date,mergedValue))&&triggerPanelChange(date,mergedMode),null==onChange||onChange(date))}(date),null==onSelect||onSelect(date)},dateRender=React.useCallback((function(date){return dateFullCellRender?dateFullCellRender(date):React.createElement("div",{className:(0,_classnames.default)("".concat(prefixCls,"-cell-inner"),"".concat(calendarPrefixCls,"-date"),(0,_defineProperty2.default)({},"".concat(calendarPrefixCls,"-date-today"),isSameDate(today,date)))},React.createElement("div",{className:"".concat(calendarPrefixCls,"-date-value")},(0,_padStart.default)(String(generateConfig.getDate(date)),2,"0")),React.createElement("div",{className:"".concat(calendarPrefixCls,"-date-content")},dateCellRender&&dateCellRender(date)))}),[dateFullCellRender,dateCellRender]),monthRender=React.useCallback((function(date,locale){if(monthFullCellRender)return monthFullCellRender(date);var months=locale.shortMonths||generateConfig.locale.getShortMonths(locale.locale);return React.createElement("div",{className:(0,_classnames.default)("".concat(prefixCls,"-cell-inner"),"".concat(calendarPrefixCls,"-date"),(0,_defineProperty2.default)({},"".concat(calendarPrefixCls,"-date-today"),isSameMonth(today,date)))},React.createElement("div",{className:"".concat(calendarPrefixCls,"-date-value")},months[generateConfig.getMonth(date)]),React.createElement("div",{className:"".concat(calendarPrefixCls,"-date-content")},monthCellRender&&monthCellRender(date)))}),[monthFullCellRender,monthCellRender]);return React.createElement(_LocaleReceiver.default,{componentName:"Calendar",defaultLocale:function getDefaultLocale(){var locale=props.locale,result=(0,_extends2.default)((0,_extends2.default)({},_en_US.default),locale);return result.lang=(0,_extends2.default)((0,_extends2.default)({},result.lang),(locale||{}).lang),result}},(function(mergedLocale){var _classNames3;return React.createElement("div",{className:(0,_classnames.default)(calendarPrefixCls,(_classNames3={},(0,_defineProperty2.default)(_classNames3,"".concat(calendarPrefixCls,"-full"),fullscreen),(0,_defineProperty2.default)(_classNames3,"".concat(calendarPrefixCls,"-mini"),!fullscreen),(0,_defineProperty2.default)(_classNames3,"".concat(calendarPrefixCls,"-rtl"),"rtl"===direction),_classNames3),className),style:style},headerRender?headerRender({value:mergedValue,type:mergedMode,onChange:onInternalSelect,onTypeChange:triggerModeChange}):React.createElement(_Header.default,{prefixCls:calendarPrefixCls,value:mergedValue,generateConfig:generateConfig,mode:mergedMode,fullscreen:fullscreen,locale:mergedLocale.lang,validRange:validRange,onChange:onInternalSelect,onModeChange:triggerModeChange}),React.createElement(_rcPicker.PickerPanel,{value:mergedValue,prefixCls:prefixCls,locale:mergedLocale.lang,generateConfig:generateConfig,dateRender:dateRender,monthCellRender:function monthCellRender(date){return monthRender(date,mergedLocale.lang)},onSelect:onInternalSelect,mode:panelMode,picker:panelMode,disabledDate:mergedDisabledDate,hideHeader:!0}))}))}}var _default=generateCalendar;exports.default=_default;