"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_createSuper2=_interopRequireDefault(require("@babel/runtime/helpers/createSuper")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),React=_interopRequireWildcard(require("react")),_rcCascader=_interopRequireDefault(require("rc-cascader")),_arrayTreeFilter=_interopRequireDefault(require("array-tree-filter")),_classnames=_interopRequireDefault(require("classnames")),_omit=_interopRequireDefault(require("rc-util/lib/omit")),_KeyCode=_interopRequireDefault(require("rc-util/lib/KeyCode")),_CloseCircleFilled=_interopRequireDefault(require("@ant-design/icons/CloseCircleFilled")),_DownOutlined=_interopRequireDefault(require("@ant-design/icons/DownOutlined")),_RightOutlined=_interopRequireDefault(require("@ant-design/icons/RightOutlined")),_RedoOutlined=_interopRequireDefault(require("@ant-design/icons/RedoOutlined")),_LeftOutlined=_interopRequireDefault(require("@ant-design/icons/LeftOutlined")),_input=_interopRequireDefault(require("../input")),_configProvider=require("../config-provider"),_LocaleReceiver=_interopRequireDefault(require("../locale-provider/LocaleReceiver")),_devWarning=_interopRequireDefault(require("../_util/devWarning")),_SizeContext=_interopRequireDefault(require("../config-provider/SizeContext")),_reactNode=require("../_util/reactNode"),_motion=require("../_util/motion");function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var __rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t},defaultLimit=50,keepFilteredValueField="__KEEP_FILTERED_OPTION_VALUE";function highlightKeyword(str,keyword,prefixCls){return str.split(keyword).map((function(node,index){return 0===index?node:[React.createElement("span",{className:"".concat(prefixCls,"-menu-item-keyword"),key:"seperator"},keyword),node]}))}function defaultFilterOption(inputValue,path,names){return path.some((function(option){return option[names.label].indexOf(inputValue)>-1}))}function defaultRenderFilteredOption(inputValue,path,prefixCls,names){return path.map((function(option,index){var label=option[names.label],node=label.indexOf(inputValue)>-1?highlightKeyword(label,inputValue,prefixCls):label;return 0===index?node:[" / ",node]}))}function defaultSortFilteredOption(a,b,inputValue,names){function callback(elem){return elem[names.label].indexOf(inputValue)>-1}return a.findIndex(callback)-b.findIndex(callback)}function getFieldNames(_ref){return _ref.fieldNames}function getFilledFieldNames(props){var fieldNames=getFieldNames(props)||{};return{children:fieldNames.children||"children",label:fieldNames.label||"label",value:fieldNames.value||"value"}}function flattenTree(options,props){var ancestor=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],names=getFilledFieldNames(props),flattenOptions=[],childrenName=names.children;return options.forEach((function(option){var path=ancestor.concat(option);!props.changeOnSelect&&option[childrenName]&&option[childrenName].length||flattenOptions.push(path),option[childrenName]&&(flattenOptions=flattenOptions.concat(flattenTree(option[childrenName],props,path)))})),flattenOptions}var defaultDisplayRender=function defaultDisplayRender(label){return label.join(" / ")};function warningValueNotExist(list){var fieldNames=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(list||[]).forEach((function(item){var valueFieldName=fieldNames.value||"value";(0,_devWarning.default)(valueFieldName in item,"Cascader","Not found `value` in `options`."),warningValueNotExist(item[fieldNames.children||"children"],fieldNames)}))}function getEmptyNode(renderEmpty,names,notFoundContent){var _ref2;return _ref2={},(0,_defineProperty2.default)(_ref2,names.value,"ANT_CASCADER_NOT_FOUND"),(0,_defineProperty2.default)(_ref2,names.label,notFoundContent||renderEmpty("Cascader")),(0,_defineProperty2.default)(_ref2,"disabled",!0),(0,_defineProperty2.default)(_ref2,"isEmptyNode",!0),_ref2}var Cascader=function(_React$Component){(0,_inherits2.default)(Cascader,_React$Component);var _super=(0,_createSuper2.default)(Cascader);function Cascader(props){var _this;return(0,_classCallCheck2.default)(this,Cascader),(_this=_super.call(this,props)).cachedOptions=[],_this.setValue=function(value){var selectedOptions=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];"value"in _this.props||_this.setState({value:value});var onChange=_this.props.onChange;null==onChange||onChange(value,selectedOptions)},_this.saveInput=function(node){_this.input=node},_this.handleChange=function(value,selectedOptions){if(_this.setState({inputValue:""}),selectedOptions[0].__IS_FILTERED_OPTION){var unwrappedValue=void 0===selectedOptions[0][keepFilteredValueField]?value[0]:selectedOptions[0][keepFilteredValueField],unwrappedSelectedOptions=selectedOptions[0].path;_this.setValue(unwrappedValue,unwrappedSelectedOptions)}else _this.setValue(value,selectedOptions)},_this.handlePopupVisibleChange=function(popupVisible){"popupVisible"in _this.props||_this.setState((function(state){return{popupVisible:popupVisible,inputFocused:popupVisible,inputValue:popupVisible?state.inputValue:""}}));var onPopupVisibleChange=_this.props.onPopupVisibleChange;null==onPopupVisibleChange||onPopupVisibleChange(popupVisible)},_this.handleInputBlur=function(){_this.setState({inputFocused:!1})},_this.handleInputClick=function(e){var _this$state=_this.state,inputFocused=_this$state.inputFocused,popupVisible=_this$state.popupVisible;(inputFocused||popupVisible)&&e.stopPropagation()},_this.handleKeyDown=function(e){e.keyCode!==_KeyCode.default.BACKSPACE&&e.keyCode!==_KeyCode.default.SPACE||e.stopPropagation()},_this.handleInputChange=function(e){var popupVisible=_this.state.popupVisible,inputValue=e.target.value;popupVisible||_this.handlePopupVisibleChange(!0),_this.setState({inputValue:inputValue})},_this.clearSelection=function(e){var inputValue=_this.state.inputValue;e.preventDefault(),e.stopPropagation(),inputValue?_this.setState({inputValue:""}):(_this.handlePopupVisibleChange(!1),_this.clearSelectionTimeout=setTimeout((function(){_this.setValue([])}),200))},_this.renderCascader=function(_ref3,locale){var getContextPopupContainer=_ref3.getPopupContainer,getPrefixCls=_ref3.getPrefixCls,renderEmpty=_ref3.renderEmpty,direction=_ref3.direction;return React.createElement(_SizeContext.default.Consumer,null,(function(size){var _classNames,_classNames2,_classNames3,_classNames5,_assertThisInitialize=(0,_assertThisInitialized2.default)(_this),props=_assertThisInitialize.props,state=_assertThisInitialize.state,customizePrefixCls=props.prefixCls,customizeInputPrefixCls=props.inputPrefixCls,children=props.children,_props$placeholder=props.placeholder,placeholder=void 0===_props$placeholder?locale.placeholder||"Please select":_props$placeholder,customizeSize=props.size,disabled=props.disabled,className=props.className,style=props.style,allowClear=props.allowClear,_props$showSearch=props.showSearch,showSearch=void 0!==_props$showSearch&&_props$showSearch,suffixIcon=props.suffixIcon,expandIcon=props.expandIcon,notFoundContent=props.notFoundContent,popupClassName=props.popupClassName,bordered=props.bordered,dropdownRender=props.dropdownRender,otherProps=__rest(props,["prefixCls","inputPrefixCls","children","placeholder","size","disabled","className","style","allowClear","showSearch","suffixIcon","expandIcon","notFoundContent","popupClassName","bordered","dropdownRender"]),mergedSize=customizeSize||size,value=state.value,inputFocused=state.inputFocused,isRtlLayout="rtl"===direction,prefixCls=getPrefixCls("cascader",customizePrefixCls),inputPrefixCls=getPrefixCls("input",customizeInputPrefixCls),sizeCls=(0,_classnames.default)((_classNames={},(0,_defineProperty2.default)(_classNames,"".concat(inputPrefixCls,"-lg"),"large"===mergedSize),(0,_defineProperty2.default)(_classNames,"".concat(inputPrefixCls,"-sm"),"small"===mergedSize),_classNames)),clearIcon=allowClear&&!disabled&&value.length>0||state.inputValue?React.createElement(_CloseCircleFilled.default,{className:"".concat(prefixCls,"-picker-clear"),onClick:_this.clearSelection}):null,arrowCls=(0,_classnames.default)((_classNames2={},(0,_defineProperty2.default)(_classNames2,"".concat(prefixCls,"-picker-arrow"),!0),(0,_defineProperty2.default)(_classNames2,"".concat(prefixCls,"-picker-arrow-expand"),state.popupVisible),_classNames2)),pickerCls=(0,_classnames.default)("".concat(prefixCls,"-picker"),(_classNames3={},(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-picker-rtl"),isRtlLayout),(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-picker-with-value"),state.inputValue),(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-picker-disabled"),disabled),(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-picker-").concat(mergedSize),!!mergedSize),(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-picker-show-search"),!!showSearch),(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-picker-focused"),inputFocused),(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-picker-borderless"),!bordered),_classNames3),className),inputProps=(0,_omit.default)(otherProps,["onChange","options","popupPlacement","transitionName","displayRender","onPopupVisibleChange","changeOnSelect","expandTrigger","popupVisible","getPopupContainer","loadData","filterOption","renderFilteredOption","sortFilteredOption","fieldNames"]),options=props.options,names=getFilledFieldNames(_this.props);options&&options.length>0?state.inputValue&&(options=_this.generateFilteredOptions(prefixCls,renderEmpty)):options=[getEmptyNode(renderEmpty,names,notFoundContent)],state.popupVisible?_this.cachedOptions=options:options=_this.cachedOptions;var inputIcon,dropdownMenuColumnStyle={},isNotFound=1===(options||[]).length&&options[0].isEmptyNode;isNotFound&&(dropdownMenuColumnStyle.height="auto"),!1!==showSearch.matchInputWidth&&(state.inputValue||isNotFound)&&_this.input&&(dropdownMenuColumnStyle.width=_this.input.input.offsetWidth),inputIcon=suffixIcon?(0,_reactNode.replaceElement)(suffixIcon,React.createElement("span",{className:"".concat(prefixCls,"-picker-arrow")},suffixIcon),(function(){var _classNames4;return{className:(0,_classnames.default)((_classNames4={},(0,_defineProperty2.default)(_classNames4,suffixIcon.props.className,suffixIcon.props.className),(0,_defineProperty2.default)(_classNames4,"".concat(prefixCls,"-picker-arrow"),!0),_classNames4))}})):React.createElement(_DownOutlined.default,{className:arrowCls});var expandIconNode,input=children||React.createElement("span",{style:style,className:pickerCls},React.createElement("span",{className:"".concat(prefixCls,"-picker-label")},_this.getLabel()),React.createElement(_input.default,(0,_extends2.default)({},inputProps,{tabIndex:-1,ref:_this.saveInput,prefixCls:inputPrefixCls,placeholder:value&&value.length>0?void 0:placeholder,className:"".concat(prefixCls,"-input ").concat(sizeCls),value:state.inputValue,disabled:disabled,readOnly:!showSearch,autoComplete:inputProps.autoComplete||"off",onClick:showSearch?_this.handleInputClick:void 0,onBlur:showSearch?_this.handleInputBlur:void 0,onKeyDown:_this.handleKeyDown,onChange:showSearch?_this.handleInputChange:void 0})),clearIcon,inputIcon);expandIconNode=expandIcon||(isRtlLayout?React.createElement(_LeftOutlined.default,null):React.createElement(_RightOutlined.default,null));var loadingIcon=React.createElement("span",{className:"".concat(prefixCls,"-menu-item-loading-icon")},React.createElement(_RedoOutlined.default,{spin:!0})),getPopupContainer=props.getPopupContainer||getContextPopupContainer,rest=(0,_omit.default)(props,["inputIcon","expandIcon","loadingIcon","bordered","className"]),rcCascaderPopupClassName=(0,_classnames.default)(popupClassName,(_classNames5={},(0,_defineProperty2.default)(_classNames5,"".concat(prefixCls,"-menu-").concat(direction),"rtl"===direction),(0,_defineProperty2.default)(_classNames5,"".concat(prefixCls,"-menu-empty"),1===options.length&&"ANT_CASCADER_NOT_FOUND"===options[0].value),_classNames5)),rootPrefixCls=getPrefixCls();return React.createElement(_rcCascader.default,(0,_extends2.default)({},rest,{prefixCls:prefixCls,getPopupContainer:getPopupContainer,options:options,value:value,popupVisible:state.popupVisible,onPopupVisibleChange:_this.handlePopupVisibleChange,onChange:_this.handleChange,dropdownMenuColumnStyle:dropdownMenuColumnStyle,expandIcon:expandIconNode,loadingIcon:loadingIcon,popupClassName:rcCascaderPopupClassName,popupPlacement:_this.getPopupPlacement(direction),dropdownRender:dropdownRender,transitionName:(0,_motion.getTransitionName)(rootPrefixCls,"slide-up",props.transitionName)}),input)}))},_this.state={value:props.value||props.defaultValue||[],inputValue:"",inputFocused:!1,popupVisible:props.popupVisible,flattenOptions:props.showSearch?flattenTree(props.options,props):void 0,prevProps:props},_this}return(0,_createClass2.default)(Cascader,[{key:"componentWillUnmount",value:function componentWillUnmount(){this.clearSelectionTimeout&&clearTimeout(this.clearSelectionTimeout)}},{key:"getLabel",value:function getLabel(){var _this$props=this.props,options=_this$props.options,_this$props$displayRe=_this$props.displayRender,displayRender=void 0===_this$props$displayRe?defaultDisplayRender:_this$props$displayRe,names=getFilledFieldNames(this.props),value=this.state.value,unwrappedValue=Array.isArray(value[0])?value[0]:value,selectedOptions=(0,_arrayTreeFilter.default)(options,(function(o,level){return o[names.value]===unwrappedValue[level]}),{childrenKeyName:names.children});return displayRender(selectedOptions.length?selectedOptions.map((function(o){return o[names.label]})):value,selectedOptions)}},{key:"generateFilteredOptions",value:function generateFilteredOptions(prefixCls,renderEmpty){var filtered,_this2=this,_this$props2=this.props,showSearch=_this$props2.showSearch,notFoundContent=_this$props2.notFoundContent,names=getFilledFieldNames(this.props),_showSearch$filter=showSearch.filter,filter=void 0===_showSearch$filter?defaultFilterOption:_showSearch$filter,_showSearch$render=showSearch.render,render=void 0===_showSearch$render?defaultRenderFilteredOption:_showSearch$render,_showSearch$sort=showSearch.sort,sort=void 0===_showSearch$sort?defaultSortFilteredOption:_showSearch$sort,_showSearch$limit=showSearch.limit,limit=void 0===_showSearch$limit?defaultLimit:_showSearch$limit,_this$state2=this.state,_this$state2$flattenO=_this$state2.flattenOptions,flattenOptions=void 0===_this$state2$flattenO?[]:_this$state2$flattenO,inputValue=_this$state2.inputValue;if(limit>0){filtered=[];var matchCount=0;flattenOptions.some((function(path){return filter(_this2.state.inputValue,path,names)&&(filtered.push(path),matchCount+=1),matchCount>=limit}))}else(0,_devWarning.default)("number"!=typeof limit,"Cascader","'limit' of showSearch should be positive number or false."),filtered=flattenOptions.filter((function(path){return filter(_this2.state.inputValue,path,names)}));if((filtered=filtered.sort((function(a,b){return sort(a,b,inputValue,names)}))).length>0){var field=names.value===names.label?keepFilteredValueField:names.value;return filtered.map((function(path){var _ref4;return _ref4={__IS_FILTERED_OPTION:!0,path:path},(0,_defineProperty2.default)(_ref4,field,path.map((function(o){return o[names.value]}))),(0,_defineProperty2.default)(_ref4,names.label,render(inputValue,path,prefixCls,names)),(0,_defineProperty2.default)(_ref4,"disabled",path.some((function(o){return!!o.disabled}))),(0,_defineProperty2.default)(_ref4,"isEmptyNode",!0),_ref4}))}return[getEmptyNode(renderEmpty,names,notFoundContent)]}},{key:"focus",value:function focus(){this.input.focus()}},{key:"blur",value:function blur(){this.input.blur()}},{key:"getPopupPlacement",value:function getPopupPlacement(){var direction=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ltr",popupPlacement=this.props.popupPlacement;return void 0!==popupPlacement?popupPlacement:"rtl"===direction?"bottomRight":"bottomLeft"}},{key:"render",value:function render(){var _this3=this;return React.createElement(_configProvider.ConfigConsumer,null,(function(configArgument){return React.createElement(_LocaleReceiver.default,null,(function(locale){return _this3.renderCascader(configArgument,locale)}))}))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(nextProps,_ref5){var prevProps=_ref5.prevProps,newState={prevProps:nextProps};return"value"in nextProps&&(newState.value=nextProps.value||[]),"popupVisible"in nextProps&&(newState.popupVisible=nextProps.popupVisible),nextProps.showSearch&&prevProps.options!==nextProps.options&&(newState.flattenOptions=flattenTree(nextProps.options,nextProps)),"production"!==process.env.NODE_ENV&&nextProps.options&&warningValueNotExist(nextProps.options,getFieldNames(nextProps)),newState}}]),Cascader}(React.Component);Cascader.defaultProps={options:[],disabled:!1,allowClear:!0,bordered:!0};var _default=Cascader;exports.default=_default;