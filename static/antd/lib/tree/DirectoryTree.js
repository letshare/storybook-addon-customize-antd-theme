"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),React=_interopRequireWildcard(require("react")),_classnames=_interopRequireDefault(require("classnames")),_debounce=_interopRequireDefault(require("lodash/debounce")),_util=require("rc-tree/lib/util"),_treeUtil=require("rc-tree/lib/utils/treeUtil"),_FileOutlined=_interopRequireDefault(require("@ant-design/icons/FileOutlined")),_FolderOpenOutlined=_interopRequireDefault(require("@ant-design/icons/FolderOpenOutlined")),_FolderOutlined=_interopRequireDefault(require("@ant-design/icons/FolderOutlined")),_configProvider=require("../config-provider"),_Tree=_interopRequireDefault(require("./Tree")),_dictUtil=require("./utils/dictUtil");function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var __rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};function getIcon(props){var isLeaf=props.isLeaf,expanded=props.expanded;return isLeaf?React.createElement(_FileOutlined.default,null):expanded?React.createElement(_FolderOpenOutlined.default,null):React.createElement(_FolderOutlined.default,null)}function getTreeData(_ref){var treeData=_ref.treeData,children=_ref.children;return treeData||(0,_treeUtil.convertTreeToData)(children)}var DirectoryTree=function DirectoryTree(_a,ref){var defaultExpandAll=_a.defaultExpandAll,defaultExpandParent=_a.defaultExpandParent,defaultExpandedKeys=_a.defaultExpandedKeys,props=__rest(_a,["defaultExpandAll","defaultExpandParent","defaultExpandedKeys"]),lastSelectedKey=React.useRef(),cachedSelectedKeys=React.useRef(),treeRef=React.createRef();React.useImperativeHandle(ref,(function(){return treeRef.current}));var _React$useState=React.useState(props.selectedKeys||props.defaultSelectedKeys||[]),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),selectedKeys=_React$useState2[0],setSelectedKeys=_React$useState2[1],_React$useState3=React.useState(function getInitExpandedKeys(){var keyEntities=(0,_treeUtil.convertDataToEntities)(getTreeData(props)).keyEntities;return defaultExpandAll?Object.keys(keyEntities):defaultExpandParent?(0,_util.conductExpandParent)(props.expandedKeys||defaultExpandedKeys||[],keyEntities):props.expandedKeys||defaultExpandedKeys}()),_React$useState4=(0,_slicedToArray2.default)(_React$useState3,2),expandedKeys=_React$useState4[0],setExpandedKeys=_React$useState4[1];React.useEffect((function(){"selectedKeys"in props&&setSelectedKeys(props.selectedKeys)}),[props.selectedKeys]),React.useEffect((function(){"expandedKeys"in props&&setExpandedKeys(props.expandedKeys)}),[props.expandedKeys]);var onDebounceExpand=(0,_debounce.default)((function expandFolderNode(event,node){node.isLeaf||event.shiftKey||event.metaKey||event.ctrlKey||treeRef.current.onNodeExpand(event,node)}),200,{leading:!0}),_React$useContext=React.useContext(_configProvider.ConfigContext),getPrefixCls=_React$useContext.getPrefixCls,direction=_React$useContext.direction,customizePrefixCls=props.prefixCls,className=props.className,otherProps=__rest(props,["prefixCls","className"]),prefixCls=getPrefixCls("tree",customizePrefixCls),connectClassName=(0,_classnames.default)("".concat(prefixCls,"-directory"),(0,_defineProperty2.default)({},"".concat(prefixCls,"-directory-rtl"),"rtl"===direction),className);return React.createElement(_Tree.default,(0,_extends2.default)({icon:getIcon,ref:treeRef,blockNode:!0},otherProps,{prefixCls:prefixCls,className:connectClassName,expandedKeys:expandedKeys,selectedKeys:selectedKeys,onSelect:function onSelect(keys,event){var _a,newSelectedKeys,multiple=props.multiple,node=event.node,nativeEvent=event.nativeEvent,_node$key=node.key,key=void 0===_node$key?"":_node$key,treeData=getTreeData(props),newEvent=(0,_extends2.default)((0,_extends2.default)({},event),{selected:!0}),ctrlPick=nativeEvent.ctrlKey||nativeEvent.metaKey,shiftPick=nativeEvent.shiftKey;multiple&&ctrlPick?(newSelectedKeys=keys,lastSelectedKey.current=key,cachedSelectedKeys.current=newSelectedKeys,newEvent.selectedNodes=(0,_dictUtil.convertDirectoryKeysToNodes)(treeData,newSelectedKeys)):multiple&&shiftPick?(newSelectedKeys=Array.from(new Set([].concat((0,_toConsumableArray2.default)(cachedSelectedKeys.current||[]),(0,_toConsumableArray2.default)((0,_dictUtil.calcRangeKeys)({treeData:treeData,expandedKeys:expandedKeys,startKey:key,endKey:lastSelectedKey.current}))))),newEvent.selectedNodes=(0,_dictUtil.convertDirectoryKeysToNodes)(treeData,newSelectedKeys)):(newSelectedKeys=[key],lastSelectedKey.current=key,cachedSelectedKeys.current=newSelectedKeys,newEvent.selectedNodes=(0,_dictUtil.convertDirectoryKeysToNodes)(treeData,newSelectedKeys)),null===(_a=props.onSelect)||void 0===_a||_a.call(props,newSelectedKeys,newEvent),"selectedKeys"in props||setSelectedKeys(newSelectedKeys)},onClick:function onClick(event,node){var _a;"click"===props.expandAction&&onDebounceExpand(event,node),null===(_a=props.onClick)||void 0===_a||_a.call(props,event,node)},onDoubleClick:function onDoubleClick(event,node){var _a;"doubleClick"===props.expandAction&&onDebounceExpand(event,node),null===(_a=props.onDoubleClick)||void 0===_a||_a.call(props,event,node)},onExpand:function onExpand(keys,info){var _a;return"expandedKeys"in props||setExpandedKeys(keys),null===(_a=props.onExpand)||void 0===_a?void 0:_a.call(props,keys,info)}}))},ForwardDirectoryTree=React.forwardRef(DirectoryTree);ForwardDirectoryTree.displayName="DirectoryTree",ForwardDirectoryTree.defaultProps={showIcon:!0,expandAction:"click"};var _default=ForwardDirectoryTree;exports.default=_default;