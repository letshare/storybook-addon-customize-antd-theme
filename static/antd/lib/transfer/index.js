"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_createSuper2=_interopRequireDefault(require("@babel/runtime/helpers/createSuper")),React=_interopRequireWildcard(require("react")),_classnames=_interopRequireDefault(require("classnames")),_list=_interopRequireDefault(require("./list")),_operation=_interopRequireDefault(require("./operation")),_search=_interopRequireDefault(require("./search")),_LocaleReceiver=_interopRequireDefault(require("../locale-provider/LocaleReceiver")),_default2=_interopRequireDefault(require("../locale/default")),_configProvider=require("../config-provider"),_devWarning=_interopRequireDefault(require("../_util/devWarning"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var Transfer=function(_React$Component){(0,_inherits2.default)(Transfer,_React$Component);var _super=(0,_createSuper2.default)(Transfer);function Transfer(props){var _this;(0,_classCallCheck2.default)(this,Transfer),(_this=_super.call(this,props)).separatedDataSource=null,_this.setStateKeys=function(direction,keys){"left"===direction?_this.setState((function(_ref){var sourceSelectedKeys=_ref.sourceSelectedKeys;return{sourceSelectedKeys:"function"==typeof keys?keys(sourceSelectedKeys||[]):keys}})):_this.setState((function(_ref2){var targetSelectedKeys=_ref2.targetSelectedKeys;return{targetSelectedKeys:"function"==typeof keys?keys(targetSelectedKeys||[]):keys}}))},_this.getLocale=function(transferLocale,renderEmpty){return(0,_extends2.default)((0,_extends2.default)((0,_extends2.default)({},transferLocale),{notFoundContent:renderEmpty("Transfer")}),_this.props.locale)},_this.moveTo=function(direction){var _this$props=_this.props,_this$props$targetKey=_this$props.targetKeys,targetKeys=void 0===_this$props$targetKey?[]:_this$props$targetKey,_this$props$dataSourc=_this$props.dataSource,dataSource=void 0===_this$props$dataSourc?[]:_this$props$dataSourc,onChange=_this$props.onChange,_this$state=_this.state,sourceSelectedKeys=_this$state.sourceSelectedKeys,targetSelectedKeys=_this$state.targetSelectedKeys,newMoveKeys=("right"===direction?sourceSelectedKeys:targetSelectedKeys).filter((function(key){return!dataSource.some((function(data){return!(key!==data.key||!data.disabled)}))})),newTargetKeys="right"===direction?newMoveKeys.concat(targetKeys):targetKeys.filter((function(targetKey){return-1===newMoveKeys.indexOf(targetKey)})),oppositeDirection="right"===direction?"left":"right";_this.setStateKeys(oppositeDirection,[]),_this.handleSelectChange(oppositeDirection,[]),null==onChange||onChange(newTargetKeys,direction,newMoveKeys)},_this.moveToLeft=function(){return _this.moveTo("left")},_this.moveToRight=function(){return _this.moveTo("right")},_this.onItemSelectAll=function(direction,selectedKeys,checkAll){_this.setStateKeys(direction,(function(prevKeys){var mergedCheckedKeys=[];return mergedCheckedKeys=checkAll?Array.from(new Set([].concat((0,_toConsumableArray2.default)(prevKeys),(0,_toConsumableArray2.default)(selectedKeys)))):prevKeys.filter((function(key){return-1===selectedKeys.indexOf(key)})),_this.handleSelectChange(direction,mergedCheckedKeys),mergedCheckedKeys}))},_this.onLeftItemSelectAll=function(selectedKeys,checkAll){return _this.onItemSelectAll("left",selectedKeys,checkAll)},_this.onRightItemSelectAll=function(selectedKeys,checkAll){return _this.onItemSelectAll("right",selectedKeys,checkAll)},_this.handleFilter=function(direction,e){var onSearch=_this.props.onSearch,value=e.target.value;null==onSearch||onSearch(direction,value)},_this.handleLeftFilter=function(e){return _this.handleFilter("left",e)},_this.handleRightFilter=function(e){return _this.handleFilter("right",e)},_this.handleClear=function(direction){var onSearch=_this.props.onSearch;null==onSearch||onSearch(direction,"")},_this.handleLeftClear=function(){return _this.handleClear("left")},_this.handleRightClear=function(){return _this.handleClear("right")},_this.onItemSelect=function(direction,selectedKey,checked){var _this$state2=_this.state,sourceSelectedKeys=_this$state2.sourceSelectedKeys,targetSelectedKeys=_this$state2.targetSelectedKeys,holder="left"===direction?(0,_toConsumableArray2.default)(sourceSelectedKeys):(0,_toConsumableArray2.default)(targetSelectedKeys),index=holder.indexOf(selectedKey);index>-1&&holder.splice(index,1),checked&&holder.push(selectedKey),_this.handleSelectChange(direction,holder),_this.props.selectedKeys||_this.setStateKeys(direction,holder)},_this.onLeftItemSelect=function(selectedKey,checked){return _this.onItemSelect("left",selectedKey,checked)},_this.onRightItemSelect=function(selectedKey,checked){return _this.onItemSelect("right",selectedKey,checked)},_this.onRightItemRemove=function(selectedKeys){var _this$props2=_this.props,_this$props2$targetKe=_this$props2.targetKeys,targetKeys=void 0===_this$props2$targetKe?[]:_this$props2$targetKe,onChange=_this$props2.onChange;_this.setStateKeys("right",[]),null==onChange||onChange(targetKeys.filter((function(key){return!selectedKeys.includes(key)})),"left",(0,_toConsumableArray2.default)(selectedKeys))},_this.handleScroll=function(direction,e){var onScroll=_this.props.onScroll;null==onScroll||onScroll(direction,e)},_this.handleLeftScroll=function(e){return _this.handleScroll("left",e)},_this.handleRightScroll=function(e){return _this.handleScroll("right",e)},_this.handleListStyle=function(listStyle,direction){return"function"==typeof listStyle?listStyle({direction:direction}):listStyle},_this.renderTransfer=function(transferLocale){return React.createElement(_configProvider.ConfigConsumer,null,(function(_ref3){var _classNames,getPrefixCls=_ref3.getPrefixCls,renderEmpty=_ref3.renderEmpty,direction=_ref3.direction,_this$props3=_this.props,customizePrefixCls=_this$props3.prefixCls,className=_this$props3.className,disabled=_this$props3.disabled,_this$props3$operatio=_this$props3.operations,operations=void 0===_this$props3$operatio?[]:_this$props3$operatio,showSearch=_this$props3.showSearch,footer=_this$props3.footer,style=_this$props3.style,listStyle=_this$props3.listStyle,operationStyle=_this$props3.operationStyle,filterOption=_this$props3.filterOption,render=_this$props3.render,children=_this$props3.children,showSelectAll=_this$props3.showSelectAll,oneWay=_this$props3.oneWay,pagination=_this$props3.pagination,prefixCls=getPrefixCls("transfer",customizePrefixCls),locale=_this.getLocale(transferLocale,renderEmpty),_this$state3=_this.state,sourceSelectedKeys=_this$state3.sourceSelectedKeys,targetSelectedKeys=_this$state3.targetSelectedKeys,mergedPagination=!children&&pagination,_this$separateDataSou=_this.separateDataSource(),leftDataSource=_this$separateDataSou.leftDataSource,rightDataSource=_this$separateDataSou.rightDataSource,leftActive=targetSelectedKeys.length>0,rightActive=sourceSelectedKeys.length>0,cls=(0,_classnames.default)(prefixCls,(_classNames={},(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-disabled"),disabled),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-customize-list"),!!children),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-rtl"),"rtl"===direction),_classNames),className),titles=_this.getTitles(locale),selectAllLabels=_this.props.selectAllLabels||[];return React.createElement("div",{className:cls,style:style},React.createElement(_list.default,(0,_extends2.default)({prefixCls:"".concat(prefixCls,"-list"),titleText:titles[0],dataSource:leftDataSource,filterOption:filterOption,style:_this.handleListStyle(listStyle,"left"),checkedKeys:sourceSelectedKeys,handleFilter:_this.handleLeftFilter,handleClear:_this.handleLeftClear,onItemSelect:_this.onLeftItemSelect,onItemSelectAll:_this.onLeftItemSelectAll,render:render,showSearch:showSearch,renderList:children,footer:footer,onScroll:_this.handleLeftScroll,disabled:disabled,direction:"left",showSelectAll:showSelectAll,selectAllLabel:selectAllLabels[0],pagination:mergedPagination},locale)),React.createElement(_operation.default,{className:"".concat(prefixCls,"-operation"),rightActive:rightActive,rightArrowText:operations[0],moveToRight:_this.moveToRight,leftActive:leftActive,leftArrowText:operations[1],moveToLeft:_this.moveToLeft,style:operationStyle,disabled:disabled,direction:direction,oneWay:oneWay}),React.createElement(_list.default,(0,_extends2.default)({prefixCls:"".concat(prefixCls,"-list"),titleText:titles[1],dataSource:rightDataSource,filterOption:filterOption,style:_this.handleListStyle(listStyle,"right"),checkedKeys:targetSelectedKeys,handleFilter:_this.handleRightFilter,handleClear:_this.handleRightClear,onItemSelect:_this.onRightItemSelect,onItemSelectAll:_this.onRightItemSelectAll,onItemRemove:_this.onRightItemRemove,render:render,showSearch:showSearch,renderList:children,footer:footer,onScroll:_this.handleRightScroll,disabled:disabled,direction:"right",showSelectAll:showSelectAll,selectAllLabel:selectAllLabels[1],showRemove:oneWay,pagination:mergedPagination},locale)))}))};var _props$selectedKeys=props.selectedKeys,selectedKeys=void 0===_props$selectedKeys?[]:_props$selectedKeys,_props$targetKeys=props.targetKeys,targetKeys=void 0===_props$targetKeys?[]:_props$targetKeys;return _this.state={sourceSelectedKeys:selectedKeys.filter((function(key){return-1===targetKeys.indexOf(key)})),targetSelectedKeys:selectedKeys.filter((function(key){return targetKeys.indexOf(key)>-1}))},_this}return(0,_createClass2.default)(Transfer,[{key:"getTitles",value:function getTitles(transferLocale){var _a;return null!==(_a=this.props.titles)&&void 0!==_a?_a:transferLocale.titles}},{key:"handleSelectChange",value:function handleSelectChange(direction,holder){var _this$state4=this.state,sourceSelectedKeys=_this$state4.sourceSelectedKeys,targetSelectedKeys=_this$state4.targetSelectedKeys,onSelectChange=this.props.onSelectChange;onSelectChange&&("left"===direction?onSelectChange(holder,targetSelectedKeys):onSelectChange(sourceSelectedKeys,holder))}},{key:"separateDataSource",value:function separateDataSource(){var _this$props4=this.props,dataSource=_this$props4.dataSource,rowKey=_this$props4.rowKey,_this$props4$targetKe=_this$props4.targetKeys,targetKeys=void 0===_this$props4$targetKe?[]:_this$props4$targetKe,leftDataSource=[],rightDataSource=new Array(targetKeys.length);return dataSource.forEach((function(record){rowKey&&(record=(0,_extends2.default)((0,_extends2.default)({},record),{key:rowKey(record)}));var indexOfKey=targetKeys.indexOf(record.key);-1!==indexOfKey?rightDataSource[indexOfKey]=record:leftDataSource.push(record)})),{leftDataSource:leftDataSource,rightDataSource:rightDataSource}}},{key:"render",value:function render(){return React.createElement(_LocaleReceiver.default,{componentName:"Transfer",defaultLocale:_default2.default.Transfer},this.renderTransfer)}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(_ref4){var selectedKeys=_ref4.selectedKeys,targetKeys=_ref4.targetKeys,pagination=_ref4.pagination,children=_ref4.children;if(selectedKeys){var mergedTargetKeys=targetKeys||[];return{sourceSelectedKeys:selectedKeys.filter((function(key){return!mergedTargetKeys.includes(key)})),targetSelectedKeys:selectedKeys.filter((function(key){return mergedTargetKeys.includes(key)}))}}return(0,_devWarning.default)(!pagination||!children,"Transfer","`pagination` not support customize render list."),null}}]),Transfer}(React.Component);Transfer.List=_list.default,Transfer.Operation=_operation.default,Transfer.Search=_search.default,Transfer.defaultProps={dataSource:[],locale:{},showSearch:!1,listStyle:function listStyle(){}};var _default=Transfer;exports.default=_default;