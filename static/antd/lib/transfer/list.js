"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_createSuper2=_interopRequireDefault(require("@babel/runtime/helpers/createSuper")),React=_interopRequireWildcard(require("react")),_omit=_interopRequireDefault(require("rc-util/lib/omit")),_classnames=_interopRequireDefault(require("classnames")),_DownOutlined=_interopRequireDefault(require("@ant-design/icons/DownOutlined")),_checkbox=_interopRequireDefault(require("../checkbox")),_menu=_interopRequireDefault(require("../menu")),_dropdown=_interopRequireDefault(require("../dropdown")),_search=_interopRequireDefault(require("./search")),_ListBody=_interopRequireWildcard(require("./ListBody")),_reactNode=require("../_util/reactNode");function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var defaultRender=function defaultRender(){return null};function isRenderResultPlainObject(result){return result&&!(0,_reactNode.isValidElement)(result)&&"[object Object]"===Object.prototype.toString.call(result)}function getEnabledItemKeys(items){return items.filter((function(data){return!data.disabled})).map((function(data){return data.key}))}var TransferList=function(_React$PureComponent){(0,_inherits2.default)(TransferList,_React$PureComponent);var _super=(0,_createSuper2.default)(TransferList);function TransferList(props){var _this;return(0,_classCallCheck2.default)(this,TransferList),(_this=_super.call(this,props)).defaultListBodyRef=React.createRef(),_this.handleFilter=function(e){var handleFilter=_this.props.handleFilter,filterValue=e.target.value;_this.setState({filterValue:filterValue}),handleFilter(e)},_this.handleClear=function(){var handleClear=_this.props.handleClear;_this.setState({filterValue:""}),handleClear()},_this.matchFilter=function(text,item){var filterValue=_this.state.filterValue,filterOption=_this.props.filterOption;return filterOption?filterOption(filterValue,item):text.indexOf(filterValue)>=0},_this.getCurrentPageItems=function(){},_this.renderListBody=function(renderList,props){var bodyContent=renderList?renderList(props):null,customize=!!bodyContent;return customize||(bodyContent=React.createElement(_ListBody.default,(0,_extends2.default)({ref:_this.defaultListBodyRef},props))),{customize:customize,bodyContent:bodyContent}},_this.renderItem=function(item){var _this$props$render=_this.props.render,renderResult=(void 0===_this$props$render?defaultRender:_this$props$render)(item),isRenderResultPlain=isRenderResultPlainObject(renderResult);return{renderedText:isRenderResultPlain?renderResult.value:renderResult,renderedEl:isRenderResultPlain?renderResult.label:renderResult,item:item}},_this.getSelectAllLabel=function(selectedCount,totalCount){var _this$props=_this.props,itemsUnit=_this$props.itemsUnit,itemUnit=_this$props.itemUnit,selectAllLabel=_this$props.selectAllLabel;if(selectAllLabel)return"function"==typeof selectAllLabel?selectAllLabel({selectedCount:selectedCount,totalCount:totalCount}):selectAllLabel;var unit=totalCount>1?itemsUnit:itemUnit;return React.createElement(React.Fragment,null,(selectedCount>0?"".concat(selectedCount,"/"):"")+totalCount," ",unit)},_this.state={filterValue:""},_this}return(0,_createClass2.default)(TransferList,[{key:"componentWillUnmount",value:function componentWillUnmount(){clearTimeout(this.triggerScrollTimer)}},{key:"getCheckStatus",value:function getCheckStatus(filteredItems){var checkedKeys=this.props.checkedKeys;return 0===checkedKeys.length?"none":filteredItems.every((function(item){return checkedKeys.indexOf(item.key)>=0||!!item.disabled}))?"all":"part"}},{key:"getFilteredItems",value:function getFilteredItems(dataSource,filterValue){var _this2=this,filteredItems=[],filteredRenderItems=[];return dataSource.forEach((function(item){var renderedItem=_this2.renderItem(item),renderedText=renderedItem.renderedText;if(filterValue&&!_this2.matchFilter(renderedText,item))return null;filteredItems.push(item),filteredRenderItems.push(renderedItem)})),{filteredItems:filteredItems,filteredRenderItems:filteredRenderItems}}},{key:"getListBody",value:function getListBody(prefixCls,searchPlaceholder,filterValue,filteredItems,notFoundContent,filteredRenderItems,checkedKeys,renderList,showSearch,disabled){var bodyNode,search=showSearch?React.createElement("div",{className:"".concat(prefixCls,"-body-search-wrapper")},React.createElement(_search.default,{prefixCls:"".concat(prefixCls,"-search"),onChange:this.handleFilter,handleClear:this.handleClear,placeholder:searchPlaceholder,value:filterValue,disabled:disabled})):null,_this$renderListBody=this.renderListBody(renderList,(0,_extends2.default)((0,_extends2.default)({},(0,_omit.default)(this.props,_ListBody.OmitProps)),{filteredItems:filteredItems,filteredRenderItems:filteredRenderItems,selectedKeys:checkedKeys})),bodyContent=_this$renderListBody.bodyContent;return bodyNode=_this$renderListBody.customize?React.createElement("div",{className:"".concat(prefixCls,"-body-customize-wrapper")},bodyContent):filteredItems.length?bodyContent:React.createElement("div",{className:"".concat(prefixCls,"-body-not-found")},notFoundContent),React.createElement("div",{className:(0,_classnames.default)(showSearch?"".concat(prefixCls,"-body ").concat(prefixCls,"-body-with-search"):"".concat(prefixCls,"-body"))},search,bodyNode)}},{key:"getCheckBox",value:function getCheckBox(_ref){var filteredItems=_ref.filteredItems,onItemSelectAll=_ref.onItemSelectAll,disabled=_ref.disabled,prefixCls=_ref.prefixCls,checkStatus=this.getCheckStatus(filteredItems),checkedAll="all"===checkStatus;return React.createElement(_checkbox.default,{disabled:disabled,checked:checkedAll,indeterminate:"part"===checkStatus,className:"".concat(prefixCls,"-checkbox"),onChange:function onChange(){onItemSelectAll(filteredItems.filter((function(item){return!item.disabled})).map((function(_ref2){return _ref2.key})),!checkedAll)}})}},{key:"render",value:function render(){var _classNames,_this3=this,filterValue=this.state.filterValue,_this$props2=this.props,prefixCls=_this$props2.prefixCls,dataSource=_this$props2.dataSource,titleText=_this$props2.titleText,checkedKeys=_this$props2.checkedKeys,disabled=_this$props2.disabled,footer=_this$props2.footer,showSearch=_this$props2.showSearch,style=_this$props2.style,searchPlaceholder=_this$props2.searchPlaceholder,notFoundContent=_this$props2.notFoundContent,selectAll=_this$props2.selectAll,selectCurrent=_this$props2.selectCurrent,selectInvert=_this$props2.selectInvert,removeAll=_this$props2.removeAll,removeCurrent=_this$props2.removeCurrent,renderList=_this$props2.renderList,onItemSelectAll=_this$props2.onItemSelectAll,onItemRemove=_this$props2.onItemRemove,_this$props2$showSele=_this$props2.showSelectAll,showSelectAll=void 0===_this$props2$showSele||_this$props2$showSele,showRemove=_this$props2.showRemove,pagination=_this$props2.pagination,footerDom=footer&&footer(this.props),listCls=(0,_classnames.default)(prefixCls,(_classNames={},(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-with-pagination"),!!pagination),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-with-footer"),!!footerDom),_classNames)),_this$getFilteredItem=this.getFilteredItems(dataSource,filterValue),filteredItems=_this$getFilteredItem.filteredItems,filteredRenderItems=_this$getFilteredItem.filteredRenderItems,listBody=this.getListBody(prefixCls,searchPlaceholder,filterValue,filteredItems,notFoundContent,filteredRenderItems,checkedKeys,renderList,showSearch,disabled),listFooter=footerDom?React.createElement("div",{className:"".concat(prefixCls,"-footer")},footerDom):null,checkAllCheckbox=!showRemove&&!pagination&&this.getCheckBox({filteredItems:filteredItems,onItemSelectAll:onItemSelectAll,disabled:disabled,prefixCls:prefixCls}),menu=null;menu=showRemove?React.createElement(_menu.default,null,pagination&&React.createElement(_menu.default.Item,{onClick:function onClick(){var _a,pageKeys=getEnabledItemKeys(((null===(_a=_this3.defaultListBodyRef.current)||void 0===_a?void 0:_a.getItems())||[]).map((function(entity){return entity.item})));null==onItemRemove||onItemRemove(pageKeys)}},removeCurrent),React.createElement(_menu.default.Item,{onClick:function onClick(){null==onItemRemove||onItemRemove(getEnabledItemKeys(filteredItems))}},removeAll)):React.createElement(_menu.default,null,React.createElement(_menu.default.Item,{onClick:function onClick(){var keys=getEnabledItemKeys(filteredItems);onItemSelectAll(keys,keys.length!==checkedKeys.length)}},selectAll),pagination&&React.createElement(_menu.default.Item,{onClick:function onClick(){var _a,pageItems=(null===(_a=_this3.defaultListBodyRef.current)||void 0===_a?void 0:_a.getItems())||[];onItemSelectAll(getEnabledItemKeys(pageItems.map((function(entity){return entity.item}))),!0)}},selectCurrent),React.createElement(_menu.default.Item,{onClick:function onClick(){var _a,availableKeys;availableKeys=getEnabledItemKeys(pagination?((null===(_a=_this3.defaultListBodyRef.current)||void 0===_a?void 0:_a.getItems())||[]).map((function(entity){return entity.item})):filteredItems);var checkedKeySet=new Set(checkedKeys),newCheckedKeys=[],newUnCheckedKeys=[];availableKeys.forEach((function(key){checkedKeySet.has(key)?newUnCheckedKeys.push(key):newCheckedKeys.push(key)})),onItemSelectAll(newCheckedKeys,!0),onItemSelectAll(newUnCheckedKeys,!1)}},selectInvert));var dropdown=React.createElement(_dropdown.default,{className:"".concat(prefixCls,"-header-dropdown"),overlay:menu,disabled:disabled},React.createElement(_DownOutlined.default,null));return React.createElement("div",{className:listCls,style:style},React.createElement("div",{className:"".concat(prefixCls,"-header")},showSelectAll?React.createElement(React.Fragment,null,checkAllCheckbox,dropdown):null,React.createElement("span",{className:"".concat(prefixCls,"-header-selected")},this.getSelectAllLabel(checkedKeys.length,filteredItems.length)),React.createElement("span",{className:"".concat(prefixCls,"-header-title")},titleText)),listBody,listFooter)}}]),TransferList}(React.PureComponent);exports.default=TransferList,TransferList.defaultProps={dataSource:[],titleText:"",showSearch:!1};