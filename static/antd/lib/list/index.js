"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof3=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.ListConsumer=exports.ListContext=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),React=_interopRequireWildcard(require("react")),_classnames=_interopRequireDefault(require("classnames")),_spin=_interopRequireDefault(require("../spin")),_useBreakpoint=_interopRequireDefault(require("../grid/hooks/useBreakpoint")),_responsiveObserve=require("../_util/responsiveObserve"),_configProvider=require("../config-provider"),_pagination=_interopRequireDefault(require("../pagination")),_grid=require("../grid"),_Item=_interopRequireDefault(require("./Item"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof3(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var __rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t},ListContext=React.createContext({});exports.ListContext=ListContext;var ListConsumer=ListContext.Consumer;function List(_a){var _classNames,_a$pagination=_a.pagination,pagination=void 0!==_a$pagination&&_a$pagination,customizePrefixCls=_a.prefixCls,_a$bordered=_a.bordered,bordered=void 0!==_a$bordered&&_a$bordered,_a$split=_a.split,split=void 0===_a$split||_a$split,className=_a.className,children=_a.children,itemLayout=_a.itemLayout,loadMore=_a.loadMore,grid=_a.grid,_a$dataSource=_a.dataSource,dataSource=void 0===_a$dataSource?[]:_a$dataSource,size=_a.size,header=_a.header,footer=_a.footer,_a$loading=_a.loading,loading=void 0!==_a$loading&&_a$loading,rowKey=_a.rowKey,renderItem=_a.renderItem,locale=_a.locale,rest=__rest(_a,["pagination","prefixCls","bordered","split","className","children","itemLayout","loadMore","grid","dataSource","size","header","footer","loading","rowKey","renderItem","locale"]),paginationObj=pagination&&"object"===(0,_typeof2.default)(pagination)?pagination:{},_React$useState=React.useState(paginationObj.defaultCurrent||1),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),paginationCurrent=_React$useState2[0],setPaginationCurrent=_React$useState2[1],_React$useState3=React.useState(paginationObj.defaultPageSize||10),_React$useState4=(0,_slicedToArray2.default)(_React$useState3,2),paginationSize=_React$useState4[0],setPaginationSize=_React$useState4[1],_React$useContext=React.useContext(_configProvider.ConfigContext),getPrefixCls=_React$useContext.getPrefixCls,renderEmpty=_React$useContext.renderEmpty,direction=_React$useContext.direction,keys={},triggerPaginationEvent=function triggerPaginationEvent(eventName){return function(page,pageSize){setPaginationCurrent(page),setPaginationSize(pageSize),pagination&&pagination[eventName]&&pagination[eventName](page,pageSize)}},onPaginationChange=triggerPaginationEvent("onChange"),onPaginationShowSizeChange=triggerPaginationEvent("onShowSizeChange"),prefixCls=getPrefixCls("list",customizePrefixCls),loadingProp=loading;"boolean"==typeof loadingProp&&(loadingProp={spinning:loadingProp});var isLoading=loadingProp&&loadingProp.spinning,sizeCls="";switch(size){case"large":sizeCls="lg";break;case"small":sizeCls="sm"}var classString=(0,_classnames.default)(prefixCls,(_classNames={},(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-vertical"),"vertical"===itemLayout),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-").concat(sizeCls),sizeCls),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-split"),split),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-bordered"),bordered),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-loading"),isLoading),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-grid"),!!grid),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-something-after-last-item"),function isSomethingAfterLastItem(){return!!(loadMore||pagination||footer)}()),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-rtl"),"rtl"===direction),_classNames),className),paginationProps=(0,_extends2.default)((0,_extends2.default)((0,_extends2.default)({},{current:1,total:0}),{total:dataSource.length,current:paginationCurrent,pageSize:paginationSize}),pagination||{}),largestPage=Math.ceil(paginationProps.total/paginationProps.pageSize);paginationProps.current>largestPage&&(paginationProps.current=largestPage);var paginationContent=pagination?React.createElement("div",{className:"".concat(prefixCls,"-pagination")},React.createElement(_pagination.default,(0,_extends2.default)({},paginationProps,{onChange:onPaginationChange,onShowSizeChange:onPaginationShowSizeChange}))):null,splitDataSource=(0,_toConsumableArray2.default)(dataSource);pagination&&dataSource.length>(paginationProps.current-1)*paginationProps.pageSize&&(splitDataSource=(0,_toConsumableArray2.default)(dataSource).splice((paginationProps.current-1)*paginationProps.pageSize,paginationProps.pageSize));var screens=(0,_useBreakpoint.default)(),currentBreakpoint=React.useMemo((function(){for(var i=0;i<_responsiveObserve.responsiveArray.length;i+=1){var breakpoint=_responsiveObserve.responsiveArray[i];if(screens[breakpoint])return breakpoint}}),[screens]),colStyle=React.useMemo((function(){if(grid){var columnCount=currentBreakpoint&&grid[currentBreakpoint]?grid[currentBreakpoint]:grid.column;return columnCount?{width:"".concat(100/columnCount,"%"),maxWidth:"".concat(100/columnCount,"%")}:void 0}}),[null==grid?void 0:grid.column,currentBreakpoint]),childrenContent=isLoading&&React.createElement("div",{style:{minHeight:53}});if(splitDataSource.length>0){var items=splitDataSource.map((function(item,index){return function renderInnerItem(item,index){return renderItem?((key="function"==typeof rowKey?rowKey(item):"string"==typeof rowKey?item[rowKey]:item.key)||(key="list-item-".concat(index)),keys[index]=key,renderItem(item,index)):null;var key}(item,index)})),childrenList=React.Children.map(items,(function(child,index){return React.createElement("div",{key:keys[index],style:colStyle},child)}));childrenContent=grid?React.createElement(_grid.Row,{gutter:grid.gutter},childrenList):React.createElement("ul",{className:"".concat(prefixCls,"-items")},items)}else children||isLoading||(childrenContent=function renderEmptyFunc(prefixCls,renderEmptyHandler){return React.createElement("div",{className:"".concat(prefixCls,"-empty-text")},locale&&locale.emptyText||renderEmptyHandler("List"))}(prefixCls,renderEmpty));var paginationPosition=paginationProps.position||"bottom";return React.createElement(ListContext.Provider,{value:{grid:grid,itemLayout:itemLayout}},React.createElement("div",(0,_extends2.default)({className:classString},rest),("top"===paginationPosition||"both"===paginationPosition)&&paginationContent,header&&React.createElement("div",{className:"".concat(prefixCls,"-header")},header),React.createElement(_spin.default,loadingProp,childrenContent,children),footer&&React.createElement("div",{className:"".concat(prefixCls,"-footer")},footer),loadMore||("bottom"===paginationPosition||"both"===paginationPosition)&&paginationContent))}exports.ListConsumer=ListConsumer,List.Item=_Item.default;var _default=List;exports.default=_default;